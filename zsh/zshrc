# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

#
# Executes commands at the start of an interactive session.
#
# Authors:
#   Sorin Ionescu <sorin.ionescu@gmail.com>
#

# Source Prezto.
if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
fi

#
# Customize to your needs...
eval "$(mise activate zsh)"

# vi モード: 挿入モード→ビームカーソル、ノーマルモード→ブロックカーソル
function zle-keymap-select {
  if [[ ${KEYMAP} == vicmd ]]; then
    echo -ne '\e[1 q'  # ブロック
  else
    echo -ne '\e[5 q'  # ビーム
  fi
}
zle -N zle-keymap-select
# シェル起動時はビームカーソル
echo -ne '\e[5 q'

# git clone with ssh
function gitcloneHTTPS() {
  parts=(${(@s:/:)1})
  echo git@github.com:${(@j:/:)parts[3,4]}
  git clone git@github.com:${(@j:/:)parts[3,4]}
}
alias gc='gitcloneHTTPS $1'

# eza: モダンなls
if command -v eza &>/dev/null; then
  alias ls='eza --icons'
  alias ll='eza -l --icons --git'
  alias la='eza -la --icons --git'
  alias lt='eza --tree --icons --level=2'
fi

# bat: シンタックスハイライト付きcat
if command -v bat &>/dev/null; then
  alias cat='bat --paging=never'
fi

# zoxide: スマートなcd (z でどこでも移動)
if command -v zoxide &>/dev/null; then
  eval "$(zoxide init zsh)"
fi

# fzf: ファジーファインダー
if [[ -f ~/.fzf.zsh ]]; then
  source ~/.fzf.zsh
elif command -v fzf &>/dev/null; then
  source <(fzf --zsh)
fi

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh
